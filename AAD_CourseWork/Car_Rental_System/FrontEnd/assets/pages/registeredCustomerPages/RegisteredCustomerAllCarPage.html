<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Easy Car Rental</title>
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <link href="../../../assets/img/car_rental_logo.png" rel="icon">

    <!--CSS FILES-->
    <link href="../../../assets/bootstrap/css/bootstrap.min.css" rel="stylesheet"/>
</head>
<body>

<header>
    <!--NAV BAR-->
    <nav class="navbar fixed-top navbar-expand-lg navbar-dark p-md-3 bg-dark  mb-0" data-bs-theme="dark" id="nav1">
        <div class="container">
            <a class="navbar-brand fs-3 fw-bold fst-italic" href="#">Easy Car <span style="color: #ff6363">Rental</span></a>
            <button
                    aria-controls="navbarNav"
                    aria-expanded="false"
                    aria-label="Toggle Navbar"
                    class="navbar-toggler"
                    data-bs-target="#navbarNav"
                    data-bs-toggle="collapse"
                    type="button">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <div class="mx-auto"></div>
                <ul class="navbar-nav fw-semibold">
                    <li class="nav-item"><a class="nav-link text-white" href="RegisteredCustomerHomePage.html">Home</a>
                    </li>
                    <!--<li class="nav-item"><a class="nav-link text-white" href="#">Cars</a></li>-->
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle text-white" data-bs-toggle="dropdown" href="#" role="button">
                            Cars
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="RegisteredCustomerAllCarPage.html">All Cars</a></li>
                            <li><a class="dropdown-item" href="#">General Cars</a></li>
                            <li><a class="dropdown-item" href="#">Premium Cars</a></li>
                            <li><a class="dropdown-item" href="#">Luxury Cars</a></li>
                        </ul>
                    </li>
                    <li class="nav-item"><a class="nav-link text-white" href="RegisteredCustomerMyBookingPage.html">My
                        Bookings</a></li>
                    <li class="nav-item"><a class="nav-link text-white" href="#">My Profile</a></li>
                    <li class="nav-item"><a class="nav-link text-white" href="../../../index.html">Logout</a></li>
                </ul>

            </div>
        </div>
    </nav>
</header>

<!--CAR LIST SECTION-->
<main id="carListMainId">
    <!--CAR LIST AREA-->
    <section class="container-fluid position-relative" style="margin-top: 100px">
        <div class="row mt-3 justify-content-center " id="carListLoadingArea">
            <div class="col-3 mx-3 mb-3 border d-flex align-items-center" id="imgDivId" style="height: 300px">
                <div class="container-fluid ">
                    <div class="row">
                        <div class="col-12 bg-primary px-0">
                            <img alt="image" class="w-100" src="../../../assets/img/cars/car-12.jpg"
                                 style="max-width: 100vw">
                        </div>

                    </div>
                    <div class="row bg-primary">
                        <div class="col-6 bg-danger ">
                            <p>Toyota Corolla</p>
                        </div>
                        <div class="col-6 bg-danger text-end">
                            <p>128$</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-3 mx-3 mb-3 border" style="height: 300px">ABC</div>
            <div class="col-3 mx-3 mb-3 border" style="height: 300px">ABC</div>
            <div class="col-3 mx-3 mb-3 border" style="height: 300px">ABC</div>
            <div class="col-3 mx-3 mb-3 border" style="height: 300px">ABC</div>
            <div class="col-3 mx-3 mb-3 border" style="height: 300px">ABC</div>
            <div class="col-3 mx-3 mb-3 border" style="height: 300px">ABC</div>
            <div class="col-3 mx-3 mb-3 border" style="height: 300px">ABC</div>
        </div>
    </section>
</main>
<!--/CAR LIST SECTION-->

<!--CAR BOOKING SECTION-->
<main id="carBookingMainId" style="margin-top: 88px">
    <div class="container-fluid">
        <div class="row">
            <div class="col-6">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-12">
                            <!--IMAGE SLIDER-->
                            <div class="carousel slide" data-bs-ride="carousel" id="carouselExampleAutoplaying">
                                <div class="carousel-inner">
                                    <div class="carousel-item active">
                                        <img alt="image 1" class="d-block w-100"
                                             src="" id="img_1">
                                    </div>
                                    <div class="carousel-item">
                                        <img alt="image 2" class="d-block w-100"
                                             src="" id="img_2">
                                    </div>
                                    <div class="carousel-item">
                                        <img alt="image 3" class="d-block w-100"
                                             src="" id="img_3">
                                    </div>
                                    <div class="carousel-item">
                                        <img alt="image 4" class="d-block w-100"
                                             src="" id="img_4">
                                    </div>
                                </div>
                                <button class="carousel-control-prev" data-bs-slide="prev"
                                        data-bs-target="#carouselExampleAutoplaying" type="button">
                                    <span aria-hidden="true" class="carousel-control-prev-icon"></span>
                                    <span class="visually-hidden">Previous</span>
                                </button>
                                <button class="carousel-control-next" data-bs-slide="next"
                                        data-bs-target="#carouselExampleAutoplaying" type="button">
                                    <span aria-hidden="true" class="carousel-control-next-icon"></span>
                                    <span class="visually-hidden">Next</span>
                                </button>
                            </div>
                        </div>
                        <div class="col-12">
                            <!--VEHICLE DETAILS TABLE-->
                            <table class="table">

                                <tbody>
                                <tr>
                                    <th scope="row">Car ID</th>
                                    <td id="td_1">CAR-000</td>
                                </tr>
                                <tr>
                                    <th scope="row">Brand</th>
                                    <td id="td_2">Toyota</td>
                                </tr>
                                <tr>
                                    <th scope="row">Model</th>
                                    <td id="td_3">Corolla</td>
                                </tr>
                                <tr>
                                    <th scope="row">Type</th>
                                    <td id="td_4">Luxury</td>
                                </tr>
                                <tr>
                                    <th scope="row">No of passengers</th>
                                    <td id="td_5">4</td>
                                </tr>
                                <tr>
                                    <th scope="row">Transmission type</th>
                                    <td id="td_6">Auto</td>
                                </tr>
                                <tr>
                                    <th scope="row">Fuel Type</th>
                                    <td id="td_7">Petrol</td>
                                </tr>
                                <tr>
                                    <th scope="row">Daily rate</th>
                                    <td id="td_8">Rs. 3000</td>
                                </tr>
                                <tr>
                                    <th scope="row">Monthly rat</th>
                                    <td id="td_9">Rs. 50000</td>
                                </tr>
                                <tr>
                                    <th scope="row">Free km For Day</th>
                                    <td id="td_10">10 km</td>
                                </tr>
                                <tr>
                                    <th scope="row">Free km For Month</th>
                                    <td id="td_11">100 km</td>
                                </tr>
                                <tr>
                                    <th scope="row">Price Per Extra km</th>
                                    <td id="td_12">Rs. 40</td>
                                </tr>
                                <tr>
                                    <th scope="row">Registration Number</th>
                                    <td id="td_13">KE - 2275</td>
                                </tr>
                                <tr>
                                    <th scope="row">Color</th>
                                    <td id="td_14">Blue</td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-6">
                <div class="container">
                    <div class="row">
                        <div class="col-12">
                            <h4>Booking Details</h4>
                            <form>
                                <div class="row">
                                    <div class="col-6">
                                        <div class="mb-3">
                                            <label class="form-label" for="pickupDateId">Pickup Date</label>
                                            <input class="form-control" id="pickupDateId" type="date">
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="mb-3">
                                            <label class="form-label" for="pickupTimeId">Pickup Time</label>
                                            <input class="form-control" id="pickupTimeId" type="time">
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="mb-3">
                                            <label class="form-label" for="pickupLocationId">Pickup Location</label>
                                            <input class="form-control" id="pickupLocationId" type="text">
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="mb-3">
                                            <label class="form-label" for="returnDateId">Return Date</label>
                                            <input class="form-control" id="returnDateId" type="date">
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="mb-3">
                                            <label class="form-label" for="destinationId">Destination</label>
                                            <input class="form-control" id="destinationId" type="text">
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="mb-3">
                                            <label class="form-label" for="driverAvailabilityId">Driver Status</label>
                                            <select aria-label="Default select example" class="form-select"
                                                    id="driverAvailabilityId">
                                                <option selected>Not Selected</option>
                                                <option value="1">Yes</option>
                                                <option value="2">No</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div class="col-12">
                            <h4>Payment Details</h4>

                        </div>
                        <div class="col-6">
                            <div class="mb-3">
                                <label class="form-label" for="txtLossDamageWaiverPaymentId">Loss Damage Waiver
                                    Payment</label>
                                <input class="form-control" id="txtLossDamageWaiverPaymentId" type="text">
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="mb-3">
                                <label class="form-label" for="txtRentalPaymentId">Rental Payment</label>
                                <input class="form-control" id="txtRentalPaymentId" type="text">
                            </div>
                        </div>
                        <div class="col-12">
                            <h6>Note</h6>
                            <p>You have to make the Loss Damage Waiver payment before booking the car. After you
                                return the car, If the vehicle is unharmed the Loss Damage Waiver will be returned in
                                full to you.</p>
                        </div>
                        <div class="col-12 mt-3">
                            <h4 class="mb-3">Your Payment</h4>

                            <!--PAYMENT AREA-->
                            <form>
                                <div class="row">
                                    <div class="col-6">
                                        <div class="mb-3">
                                            <label class="form-label" for="selectReasonId">Select the reason</label>
                                            <select aria-label="Default select example" class="form-select"
                                                    id="selectReasonId">
                                                <option selected>Not Selected</option>
                                                <option value="1">Loss Damage Waiver Payment</option>
                                                <option value="2">Rental Payment</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="mb-3">
                                            <label class="form-label" for="txtCustomerId">Your ID</label>
                                            <input class="form-control" id="txtCustomerId" type="text">
                                        </div>
                                    </div>
                                    <div class="col-6 mb-2">
                                        <label class="form-label" for="uploadBnkSlipImgDiv1">Choose Your Bank
                                            Slip</label>
                                        <div class="input-group" id="uploadBnkSlipImgDiv1">
                                            <input class="form-control" id="bankSlipImageChooserId"
                                                   type="file">
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="mb-3">
                                            <label class="form-label" for="txtPayingAmountId">Paying Amount</label>
                                            <input class="form-control" id="txtPayingAmountId" type="text">
                                        </div>
                                    </div>

                                    <div class="col-12 d-flex justify-content-center align-items-center">
                                        <button class="btn btn-primary w-25" type="button">Booking
                                        </button>
                                    </div>

                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>
<!--/CAR BOOKING SECTION-->


<script src="../../../assets/bootstrap/js/bootstrap.min.js"></script>
<script src="../../../assets/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="../../../assets/jQuery/jquery-3.6.0.min.js"></script>

<script>

    let baseUrl = "http://localhost:8080/BackEnd_SpringMVC_war_exploded/";

    $("#carListMainId").css("display", "block");
    $("#carBookingMainId").css("display", "none");

    loadCarsToThePage();

    /*SET IMAGES TO IMAGE VIEW*/
    function loadCarImages(carFrontImgPath, carBackImgPath, carSideImgPath, carInteriorImgPath) {
        let frontImgNameArray = carFrontImgPath.split("\\CarImages\\");
        $("#img_1").attr('src', "../../imgUpload/CarImages/" + frontImgNameArray[1]);

        let backImgNameArray = carBackImgPath.split("\\CarImages\\");
        $("#img_2").attr('src', "../../imgUpload/CarImages/" + backImgNameArray[1]);

        let sideImgNameArray = carSideImgPath.split("\\CarImages\\");
        $("#img_3").attr('src', "../../imgUpload/CarImages/" + sideImgNameArray[1]);

        let interiorImgNameArray = carInteriorImgPath.split("\\CarImages\\");
        $("#img_4").attr('src', "../../imgUpload/CarImages/" + interiorImgNameArray[1]);
    }

    function loadBookingArea(carId) {
        //console.log("Booking Area Car ID : "+carId);

        $.ajax({
            url: baseUrl + "car/getCar/" + carId,
            dataType: "JSON",
            success: function (resp) {
                //console.log(resp);
                $("#td_1").text(resp.data.carId);
                $("#td_2").text(resp.data.carCategory.carBrandName);
                $("#td_3").text(resp.data.carCategory.carModel);
                $("#td_4").text(resp.data.carCategory.carType);
                $("#td_5").text(resp.data.passengersCount);
                $("#td_6").text(resp.data.carCategory.carTransmissionType);
                $("#td_7").text(resp.data.carCategory.carFuelType);
                $("#td_8").text(resp.data.carCategory.dailyRatePrice);
                $("#td_9").text(resp.data.carCategory.monthlyRatePrice);
                $("#td_10").text(resp.data.carCategory.freeKmForDay);
                $("#td_11").text(resp.data.carCategory.freeKmForMonth);
                $("#td_12").text(resp.data.carCategory.pricePerExtraKm);
                $("#td_13").text(resp.data.registrationNum);
                $("#td_14").text(resp.data.color);


                /*LOAD CAR IMAGES*/
                loadCarImages(resp.data.frontImgPath, resp.data.backImgPath, resp.data.sideImgPath, resp.data.interiorPath);
            },
            error: function (error) {
                let cause = JSON.parse(error.responseText).message;
                alert(cause);
            }
        });

        //TODO
    }

    /*LOAD CARS FOR THE PAGE*/
    function loadCarsToThePage() {
        $("#carListLoadingArea").empty();

        $.ajax({
            url: baseUrl + "car",
            dataType: "JSON",
            success: function (resp) {
                console.log(resp.data);
                for (let car of resp.data) {

                    let carId = car.carId;
                    let frontImgNameArray = car.frontImgPath.split("\\CarImages\\");
                    //$("#img1").attr('src', "../../imgUpload/CarImages/" + frontImgNameArray[1]);

                    console.log("img path : " + frontImgNameArray[1])
                    var imgContent = "<div class=\"col-3 mx-3 mb-3 border d-flex align-items-center\" id=\"imgDivId\" style=\"height: 300px\">" + "<div class=\"container-fluid \">" + "<div class=\"row\">" + "<div class=\"col-12 bg-primary px-0\">" + "<img alt=\"image\" class=\"w-100\" src=\"\" style=\"max-width: 100vw\" id=\"carImg_1\">" + "</div>" + "</div>" + "<div class=\"row bg-primary\">" + "<div class=\"col-6 bg-danger \">" + "<p id=\"p1\">Toyota Corolla</p>" + "</div>" + "<div class=\"col-6 bg-danger text-end\">" + "<p id=\"p2\">128$</p>" + "</div>" + "</div>" + "</div>" + "</div>";
                    $("#carListLoadingArea").append(imgContent);

                    /*SET VALUE ATTRIBUTE VALUE TO IMAGE CONTAINER*/
                    $("#imgDivId").attr('id', "imgDivId_" + carId);
                    $("#imgDivId_" + carId).attr('value', carId);
                    //$("#imgDivId_"+carId)

                    /*SET IMAGE*/
                    $("#carImg_1").attr('id', carId);
                    $("#" + carId + "").attr('src', "../../imgUpload/CarImages/" + frontImgNameArray[1]);

                    /*SET CAR BRAND AND MODEL*/
                    $("#p1").attr('id', "p1_" + carId);
                    $("#p1_" + carId).text(car.carCategory.carBrandName + ' ' + car.carCategory.carModel);

                    /*SET PRICE*/
                    $("#p2").attr('id', "p2_" + carId);
                    $("#p2_" + carId).text("Rs. " + car.carCategory.dailyRatePrice);


                    bindingImageAreaClickEvent("imgDivId_" + carId);
                }
                //bindingImageAreaClickEvent();
            }
        });


    }

    /*EVENT BINDING FOR THE CAR IMAGE AREA*/
    function bindingImageAreaClickEvent(clickAreaId) {
        $("#" + clickAreaId).click(function () {
            $("#carListMainId").css("display", "none");
            $("#carBookingMainId").css("display", "block");

            let carId = $(this).attr('value');
            loadBookingArea(carId);
        });
    }
</script>
</body>
</html>